# ğŸ—ï¸ Phase 5 Architecture Overview

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Next.js 15)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 Pages & Components                          â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  ğŸ“ /foods/available                                        â”‚ â”‚
â”‚  â”‚     â”œâ”€ Filter UI (Category/Price/Availability)            â”‚ â”‚
â”‚  â”‚     â”œâ”€ Grid View (FoodCard components)                    â”‚ â”‚
â”‚  â”‚     â””â”€ Map View (GoogleMapView)                           â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  â¤ï¸ /foods/saved                                           â”‚ â”‚
â”‚  â”‚     â”œâ”€ Bookmarked Foods Grid                              â”‚ â”‚
â”‚  â”‚     â”œâ”€ Empty State                                        â”‚ â”‚
â”‚  â”‚     â””â”€ Refresh & Sort                                    â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  ğŸ² FoodCard Component (Redesigned)                       â”‚ â”‚
â”‚  â”‚     â”œâ”€ Category Badge (Veg/Non-Veg/Snacks/Meals/Desserts)â”‚ â”‚
â”‚  â”‚     â”œâ”€ Price Display (Free or â‚¹amount)                    â”‚ â”‚
â”‚  â”‚     â”œâ”€ Bookmark Button (Yellow Heart)                    â”‚ â”‚
â”‚  â”‚     â”œâ”€ Navigate Button (Google Maps)                     â”‚ â”‚
â”‚  â”‚     â”œâ”€ Request Button                                    â”‚ â”‚
â”‚  â”‚     â”œâ”€ Expiry Alert Badge (â° Expiring)                    â”‚ â”‚
â”‚  â”‚     â”œâ”€ Status Badge (âœ“ Requested)                        â”‚ â”‚
â”‚  â”‚     â””â”€ Distance Badge (ğŸ“ km)                             â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                           â”‚                            â”‚
â”‚         â–¼                           â–¼                            â–¼
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚  API Client  â”‚          â”‚   Database   â”‚        â”‚   Images     â”‚
â”‚   â”‚  (api.ts)    â”‚          â”‚  (Local)     â”‚        â”‚  (Blob/URL)  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    â”‚   New Functions Added:       â”‚                  â”‚
â”‚    â”‚                              â”‚                  â”‚
â”‚    â”œâ”€ bookmarkFood()              â”‚                  â”‚
â”‚    â”œâ”€ removeBookmark()            â”‚                  â”‚
â”‚    â”œâ”€ getBookmarkedFoods()        â”‚                  â”‚
â”‚    â””â”€ updateRequestStatus()       â”‚                  â”‚
â”‚                                   â–¼                  â–¼
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â”‚    Authorization Store         â”‚
â”‚                          â”‚    (Token: localStorage)        â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTP/HTTPS
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND (Express.js)                        â”‚
â”‚                      Port: 5000                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   API Routes                               â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  POST   /foods/nearby/search (GET - renamed POST later)    â”‚ â”‚
â”‚  â”‚         â”œâ”€ lat, lng (required)                             â”‚ â”‚
â”‚  â”‚         â”œâ”€ distance (optional)                             â”‚ â”‚
â”‚  â”‚         â”œâ”€ category (optional)                             â”‚ â”‚
â”‚  â”‚         â”œâ”€ priceRange (optional)                           â”‚ â”‚
â”‚  â”‚         â””â”€ availability (optional)                         â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  POST   /foods/:foodId/bookmark                            â”‚ â”‚
â”‚  â”‚  POST   /foods/:foodId/bookmark/remove                     â”‚ â”‚
â”‚  â”‚  GET    /foods/saved/all                                   â”‚ â”‚
â”‚  â”‚  PUT    /foods/:foodId/request/:requestId/status           â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                           â”‚                            â”‚
â”‚         â–¼                           â–¼                            â–¼
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚  Controllers     â”‚    â”‚  Middleware      â”‚    â”‚   Routes     â”‚
â”‚   â”‚  (foodController)â”‚    â”‚  (auth, error)   â”‚    â”‚              â”‚
â”‚   â”‚                  â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚   â”‚ âœ¨ NEW METHODS:  â”‚    â”‚   âœ“ protect      â”‚    â”‚ âœ“ 4 new      â”‚
â”‚   â”‚                  â”‚    â”‚                  â”‚    â”‚   endpoints  â”‚
â”‚   â”œâ”€createFood()     â”‚    â”‚   âœ“ validate     â”‚    â”‚              â”‚
â”‚   â”œâ”€getNearbyFoods() â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚   â”œâ”€bookmarkFood()   â”‚    â”‚   âœ“ errorHandlerâ”‚    â”‚              â”‚
â”‚   â”œâ”€removeBookmark() â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚   â”œâ”€getBookmarked()  â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚   â””â”€updateReqStatus()â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚                  â”‚    â”‚                  â”‚    â”‚              â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                               â”‚             â”‚
â”‚                               â–¼             â–¼
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         â”‚  Database Models         â”‚
â”‚                         â”‚  (Mongoose)              â”‚
â”‚                         â”‚                          â”‚
â”‚                         â”œâ”€ Food.js âœ¨ UPDATED     â”‚
â”‚                         â”‚  â”œâ”€ category            â”‚
â”‚                         â”‚  â”œâ”€ price               â”‚
â”‚                         â”‚  â”œâ”€ bookmarkedBy []     â”‚
â”‚                         â”‚  â””â”€ (other fields)      â”‚
â”‚                         â”‚                          â”‚
â”‚                         â”œâ”€ User.js                â”‚
â”‚                         â”œâ”€ FoodRequest.js         â”‚
â”‚                         â””â”€ Comment.js             â”‚
â”‚                               â”‚
â”‚                               â–¼
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       â”‚   MongoDB        â”‚
â”‚                       â”‚                  â”‚
â”‚                       â”œâ”€ foods (cols)    â”‚
â”‚                       â”œâ”€ users (cols)    â”‚
â”‚                       â”œâ”€ requests (cols) â”‚
â”‚                       â””â”€ comments (cols) â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagrams

### 1ï¸âƒ£ Bookmark Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 User Clicks Bookmark Button                 â”‚
â”‚                     (FoodCard)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ handleBookmark â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚                       â”‚
                 â–¼                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ isBookmarked    â”‚    â”‚ isBookmarking    â”‚
        â”‚ ? removeBookmarkâ”‚    â”‚ = true           â”‚
        â”‚ : bookmarkFood  â”‚    â”‚ (show loading)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  API Call to Backend:       â”‚
    â”‚  POST /foods/:id/bookmark   â”‚
    â”‚  or                         â”‚
    â”‚  POST /foods/:id/bookmark   â”‚
    â”‚           /remove           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Backend Updates Database:  â”‚
    â”‚ - Add/Remove from          â”‚
    â”‚   bookmarkedBy array       â”‚
    â”‚ - Return success/error     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend Updates State:     â”‚
    â”‚  - setIsBookmarking(false)   â”‚
    â”‚  - Update foodData           â”‚
    â”‚  - Call onBookmarkChange()   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  UI Re-renders:              â”‚
    â”‚  - Heart button filled       â”‚
    â”‚  - Toast shows "Bookmarked"  â”‚
    â”‚  - /foods/saved updated      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2ï¸âƒ£ Filter Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Selects Filter (Category/Price/ â”‚
â”‚         Availability)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚           â”‚
         â–¼           â–¼           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Categoryâ”‚  â”‚ Price  â”‚  â”‚Availabilityâ”‚
   â”‚= "Veg" â”‚  â”‚="free" â”‚  â”‚="expiring" â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  useEffect Triggered:        â”‚
    â”‚  Dependencies changed        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  fetchNearbyFoods() Called   â”‚
    â”‚  with all filter values      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  API Request Built:              â”‚
    â”‚ /foods/nearby/search?           â”‚
    â”‚   lat=28.123&lng=77.456         â”‚
    â”‚   &category=Veg                 â”‚
    â”‚   &priceRange=free              â”‚
    â”‚   &availability=expiring        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend Processes Filters:  â”‚
    â”‚  - Build filter object       â”‚
    â”‚  - Query MongoDB             â”‚
    â”‚  - Calculate stats           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Results Returned:           â”‚
    â”‚  - Only Veg items            â”‚
    â”‚  - That are Free             â”‚
    â”‚  - Expiring in <2 hours      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend Updates Grid:      â”‚
    â”‚  - Fetched foods mapped to   â”‚
    â”‚    FoodCard components       â”‚
    â”‚  - Each card shows filtered  â”‚
    â”‚    results                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3ï¸âƒ£ Request Status Update Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Food Owner Sees Pending Request       â”‚
â”‚  (Admin Dashboard / Request List)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚           â”‚
         â–¼           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Accept â”‚  â”‚ Reject â”‚  â”‚ Complete â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  updateRequestStatus() Call    â”‚
    â”‚  with new status value         â”‚
    â”‚  (e.g., "accepted")            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PUT /foods/:foodId/request    â”‚
    â”‚      /:requestId/status        â”‚
    â”‚  { status: "accepted" }        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Backend Validates:            â”‚
    â”‚  - Is user food owner?         â”‚
    â”‚  - Does request exist?         â”‚
    â”‚  - Is status valid?            â”‚
    â”‚  - Is current status pending?  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
        â–¼                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ IF Status  â”‚    â”‚ IF Rejected  â”‚
    â”‚ ="accepted"â”‚    â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚
          â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Update Food:     â”‚ â”‚ Update Request â”‚
    â”‚ - status="req.." â”‚ â”‚ - status only  â”‚
    â”‚ - requestedBy=ID â”‚ â”‚ - Keep food    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   available    â”‚
             â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Return Updated Request Object â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Frontend Updates:             â”‚
    â”‚  - Admin/Owner dashboard       â”‚
    â”‚  - Request shows new status    â”‚
    â”‚  - User A sees badge on card   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Model Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     User        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id             â”‚
â”‚ name            â”‚
â”‚ email           â”‚
â”‚ password        â”‚
â”‚ rating          â”‚
â”‚ createdAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â†‘â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:Many
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Food         â”‚  â”‚  FoodRequest     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id             â”‚  â”‚ _id              â”‚
â”‚ title           â”‚  â”‚ foodId (ref)     â”‚
â”‚ description     â”‚  â”‚ userId (ref)     â”‚
â”‚ image           â”‚  â”‚ ownerId (ref)    â”‚
â”‚ âœ¨category      â”‚  â”‚ âœ¨status         â”‚
â”‚ âœ¨price         â”‚  â”‚ createdAt        â”‚
â”‚ quantity        â”‚  â”‚ updatedAt        â”‚
â”‚ locationName    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ latitude        â”‚
â”‚ longitude       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ status          â”‚  â”‚  Comment         â”‚
â”‚ ownerId (ref)â–ˆâ–ˆâ–ˆâ–ˆâ”€â”€â”‚ _id              â”‚
â”‚ requestedBy     â”‚  â”‚ foodId (ref)     â”‚
â”‚ âœ¨bookmarkedBy[]â”‚  â”‚ userId (ref)     â”‚
â”‚ likes []        â”‚  â”‚ text             â”‚
â”‚ comments []     â”‚  â”‚ createdAt        â”‚
â”‚ createdAt       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ expiryTime      â”‚
â”‚ updatedAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Hierarchy

```
â”Œâ”€ App Layout
â”‚
â”œâ”€ /foods/available
â”‚  â”œâ”€ Header
â”‚  â”œâ”€ Filter Controls (Category, Price, Availability)
â”‚  â”œâ”€ Sort & Radius
â”‚  â”œâ”€ View Mode Toggle (Grid/Map)
â”‚  â”‚
â”‚  â”œâ”€ GridView
â”‚  â”‚  â”œâ”€ FoodCard âœ¨ Version 2
â”‚  â”‚  â”‚  â”œâ”€ Image Container
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Category Badge âœ¨
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Status Badges âœ¨
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Distance Badge
â”‚  â”‚  â”‚  â”‚  â””â”€ Bookmark Button âœ¨
â”‚  â”‚  â”‚  â”œâ”€ Title & Description
â”‚  â”‚  â”‚  â”œâ”€ Owner Info
â”‚  â”‚  â”‚  â”œâ”€ Meta Info (Date, Qty, Location)
â”‚  â”‚  â”‚  â”œâ”€ Like/Comment Stats
â”‚  â”‚  â”‚  â”œâ”€ Comments Section
â”‚  â”‚  â”‚  â””â”€ Action Buttons
â”‚  â”‚  â”‚     â”œâ”€ Navigate Button âœ¨
â”‚  â”‚  â”‚     â””â”€ Request Button
â”‚  â”‚  â”œâ”€ FoodCard
â”‚  â”‚  â””â”€ FoodCard
â”‚  â”‚
â”‚  â””â”€ MapView
â”‚     â””â”€ GoogleMapView
â”‚
â”œâ”€ /foods/saved âœ¨ NEW PAGE
â”‚  â”œâ”€ Header (with Bookmark icon)
â”‚  â”œâ”€ Refresh Button
â”‚  â”œâ”€ Grid of Bookmarked FoodCards
â”‚  â””â”€ Empty State
â”‚
â””â”€ Toast Notifications
```

---

## Filter Integration Points

```
Frontend Filter Selection
        â”‚
        â””â”€â†’ React State Updates
            (categoryFilter, priceFilter, availabilityFilter)
            â”‚
            â””â”€â†’ useEffect Dependency Array Triggered
                â”‚
                â””â”€â†’ fetchNearbyFoods() Called
                    â”‚
                    â””â”€â†’ API Client (api.ts)
                        â”‚
                        â””â”€â†’ HTTP Request Built:
                            /foods/nearby/search?
                            category={categoryFilter}&
                            priceRange={priceFilter}&
                            availability={availabilityFilter}
                            â”‚
                            â””â”€â†’ Express Backend
                                â”‚
                                â””â”€â†’ Controller (foodController.js)
                                    â”‚
                                    â””â”€â†’ getNearbyFoods()
                                        â”‚
                                        â”œâ”€â†’ Build MongoDB Query
                                        â”‚   {
                                        â”‚     category: "Veg",
                                        â”‚     price: 0,
                                        â”‚     expiryTime: { $gte: now, $lte: +2h }
                                        â”‚   }
                                        â”‚
                                        â””â”€â†’ Execute & Return Results
                                            â”‚
                                            â””â”€â†’ Frontend Grid Updates in Real-Time
```

---

## State Management Overview

### AvailableFoodsPage State
```javascript
const [foods, setFoods] = useState<Food[]>([])
const [isLoading, setIsLoading] = useState(false)
const [radius, setRadius] = useState(5000)
const [sortBy, setSortBy] = useState<'distance' | 'recent'>('distance')
const [categoryFilter, setCategoryFilter] = useState<string>('All') âœ¨
const [priceFilter, setPriceFilter] = useState<string>('All') âœ¨
const [availabilityFilter, setAvailabilityFilter] = useState<string>('All') âœ¨
```

### FoodCard Component State
```javascript
const [foodData, setFoodData] = useState<Food>(food)
const [isRequesting, setIsRequesting] = useState(false)
const [hasRequested, setHasRequested] = useState(false)
const [isLiking, setIsLiking] = useState(false)
const [isBookmarking, setIsBookmarking] = useState(false) âœ¨
const [commentText, setCommentText] = useState('')
const [showComments, setShowComments] = useState(false)
```

### SavedFoodsPage State
```javascript
const [foods, setFoods] = useState<Food[]>([])
const [isLoading, setIsLoading] = useState(false)
const [error, setError] = useState<string | null>(null) âœ¨
```

---

## API Call Sequence Diagram

```
Frontend Action â†’ API Function â†’ HTTP Request â†’ Backend Handler
    â”‚               â”‚                 â”‚              â”‚
    â”œâ”€ User clicks  â”œâ”€ bookmarkFood() â”œâ”€ POST       â”œâ”€ protect
    â”‚   bookmark    â”‚ (food ID)       â”‚ /bookmark   â”‚ middleware
    â”‚               â”‚                 â”‚             â”‚
    â”‚               â”‚                 â–¼             â”œâ”€ Validate
    â””â”€ FoodCard     â”œâ”€ Headers with   â”‚             â”‚
                    â”‚   auth token    â”‚             â”œâ”€ MongoDB
                    â”‚                 â”‚             â”‚  update
                    â””â”€ Error          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                       handling                     â”œâ”€ Return
                       (catch block)                â”‚  response
                       â”‚                           â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                                                  â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                            JSON Response
                            { success, data }
                                    â”‚
                                    â”œâ”€ Update state
                                    â”œâ”€ Show toast
                                    â””â”€ Re-render UI
```

---

**Last Updated**: Phase 5 Complete
**Architecture Version**: 1.0
**Status**: âœ… Production Ready
